{"version":3,"file":"productModel.js","sourceRoot":"","sources":["../../../src/models/productModel.ts"],"names":[],"mappings":"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","sourcesContent":["import DbClient = require(\"../DbClient\");\r\n\r\nexport class ProductModel {\r\n\r\n    constructor() {}\r\n    /*\r\n        input type: key value arr, example :  [{\"1\":300}, {\"3\":400},{\"5\":500}]\r\n        returns an array of shoe objects ex: [ {shoe_1 ...}, {shoe_2 ...}, {shoe_3}...]\r\n     */\r\n    public getAllShoes(shoeKeysVal: any) {\r\n\r\n        const keyArr: any[] = [];\r\n\r\n        // get the keys from the input, keys_arr should be equal to [1,3,5] from the example above\r\n\r\n        let prop;\r\n        for (prop of shoeKeysVal) {\r\n            keyArr.push(JSON.parse(JSON.stringify(prop)).shoe_id);\r\n        }\r\n\r\n        // an array of objects holding indvidual json objects for each of the shoes the user has\r\n        const jsonShoeArr: any[] = [];\r\n\r\n        const shoes = DbClient.connect()\r\n            .then((db) => {\r\n                // returns shoes in db\r\n                return db!.collection(\"shoes\").find().toArray();\r\n            })\r\n            .then((sneakers: any) => {\r\n                // loop over all the shoes in db and push into jsonShoeArr only those that are\r\n                // owned by user\r\n                let id;\r\n                let shoe;\r\n                for (shoe of sneakers ) {\r\n                    for (id of keyArr) {\r\n                        // if current shoe is also a shoe owned by user, id is type string so we typecast to number\r\n                        if (shoe.shoe_id === Number(id)) {\r\n                            jsonShoeArr.push(shoe);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                return jsonShoeArr;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Getting all shoes has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    /*\r\n     Input type: integer that refers to the shoe_id. ex: 3\r\n     Output type: a json shoe obejct ex: {shoe_id:3 ... }\r\n     */\r\n\r\n    public getOneShoe(shoeID: any) {\r\n\r\n        // an array of objects holding indvidual json objects for each of the shoes the user has\r\n        const jsonShoeArr: any[] = [];\r\n\r\n        const shoes = DbClient.connect()\r\n            .then((db) => {\r\n                // will return all the shoes in db\r\n                return db!.collection(\"shoes\").find().toArray();\r\n            })\r\n            .then((sneakers: any) => {\r\n                // loop over all the shoes in db and push into jsonShoeArr only the shoe that has id\r\n                // shoeID\r\n                let shoe;\r\n                for ( shoe of sneakers ) {\r\n                    // if current shoe is also a shoe whose id is shoeID, shoeID is type string so we typecast to number\r\n                    if (shoe.shoe_id === Number(shoeID)) {\r\n                        jsonShoeArr.push(shoe);\r\n                        break;\r\n                    }\r\n                }\r\n                return jsonShoeArr[0];\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Getting a shoe has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    /*\r\n            Return all the shoes for the view where we need to see all shoes available in db\r\n     */\r\n\r\n    public updateShoes(priceChange: any) {\r\n        const shoeUpdate = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").updateMany({}, { $inc: { current_price: priceChange }});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Failed to update shoes\");\r\n                return false;\r\n            });\r\n        return shoeUpdate;\r\n    }\r\n\r\n    public getAllDB() {\r\n        const shoes = DbClient.connect()\r\n            .then((db) => {\r\n                return db!.collection(\"shoes\").find().toArray();\r\n            })\r\n            .then((sneakers: any) => {\r\n                return sneakers;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Returning all shoes in the database has failed\");\r\n            });\r\n\r\n        return shoes;\r\n    }\r\n\r\n    public add_shoe(model: any, shoeId: any, size: any, cp: any, rp: any, brand: any, colorway: any) {\r\n        const addShoes = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").insertOne({ brand, colorway, current_price: cp,\r\n                    model, retail_price: rp, shoe_id: shoeId, size});\r\n\r\n                console.log(\"adding shoe\");\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Failed to add a shoe\");\r\n                return false;\r\n            });\r\n        return addShoes;\r\n    }\r\n\r\n    public edit_shoe(model: any, shoeId: any, size: any, cp: any, rp: any, brand: any, colorway: any) {\r\n        const result = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").updateOne({shoe_id: shoeId},\r\n                    {$set: {brand, colorway, current_price: cp, model, retail_price: rp, size}});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Editing a shoe has failed\");\r\n                return false;\r\n            });\r\n        return result;\r\n    }\r\n\r\n    public remove_shoe(shoeId: any) {\r\n        const removeUser = DbClient.connect()\r\n            .then((db) => {\r\n                db!.collection(\"shoes\").deleteOne({ shoe_id: shoeId});\r\n                db!.collection(\"user_shoes\").deleteMany({ shoe_id: shoeId});\r\n                db!.collection(\"notifications\").deleteMany({ shoe_id: shoeId});\r\n                db!.collection(\"users\").deleteMany({ shoe_id: null});\r\n                return true;\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Removing a shoe has failed\");\r\n                return false;\r\n            });\r\n        return removeUser;\r\n    }\r\n\r\n}\r\n"]}