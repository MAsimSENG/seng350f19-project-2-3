<<<<<<< HEAD
{"version":3,"file":"customerRouter.js","sourceRoot":"","sources":["../../../src/routes/customerRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response, Router} from \"express\";\r\nimport { UserModel } from \"../models/user_model\";\r\nimport { BaseRoute } from \"./router\";\r\nimport helpers = require(\"../helperFunctions\");\r\n\r\nlet userJson: any;\r\nlet userShoes: any[] = [];\r\nlet userKeys: any;\r\nlet netGain: number = 0;\r\nlet sunkCost: number = 0;\r\nlet totalRevenue: number = 0;\r\n\r\nexport class CustomerRouter extends BaseRoute {\r\n\r\n    public static create(router: Router) {\r\n        // sorting all the shoes the user owns from low to high\r\n        router.get(\"/user/:id/shoes/sort/price_low\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().sortPriceLow(req, res, next);\r\n        });\r\n        // sorting the shoes the user owns from high to low\r\n        router.get(\"/user/:id/shoes/sort/price_high\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().sortPriceHigh(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/add_shoe/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().addShoe(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/remove_shoe/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().removeShoe(req, res, next);\r\n        });\r\n        // users home page showing all the shoes the user owns\r\n        router.get(\"/user/:id/shoes\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().getAll(req, res, next);\r\n        });\r\n        // showing a specific shoe that the user owns\r\n        router.get(\"/user/:id/shoes/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().getOne(req, res, next);\r\n        });\r\n    }\r\n\r\n    public async sortPriceLow(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        if (await helpers.check_local(queryint)) {\r\n            const sortedShoes: any = userShoes;\r\n            sortedShoes.sort((a: any, b: any) => a.current_price - b.current_price);\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, username: userJson.username, title: \"Shoes\", data: sortedShoes, net: netGain,\r\n                total: totalRevenue, sunk: sunkCost});\r\n        } else {\r\n            res.status(404);\r\n            res.send(\"invalid user\");\r\n        }\r\n\r\n    }\r\n\r\n    public async sortPriceHigh(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        if (await helpers.check_local(queryint)) {\r\n            const sortedShoes: any = userShoes;\r\n            sortedShoes.sort((a: any, b: any) => b.current_price - a.current_price);\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, username: userJson.username, title: \"Shoes\", data: sortedShoes, net: netGain,\r\n                total: totalRevenue, sunk: sunkCost});\r\n        } else {\r\n            res.status(404);\r\n            res.send(\"invalid user\");\r\n        }\r\n\r\n    }\r\n\r\n\r\n    public async addShoe(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const shoeIdString = \"id2\";\r\n        const shoeId = parseInt(req.params[shoeIdString], 10);\r\n        if (await helpers.check_local(userId)) {\r\n            const uif = new UserModel();\r\n            let price = req.body.purchase_price;\r\n            if (!price) {\r\n                price = 0;\r\n            }\r\n            await uif.add_shoe(userId, shoeId, price);\r\n            res.redirect(\"/user/\" + userId + \"/shoes/\");\r\n        } else {\r\n            res.status(404)\r\n            .send({\r\n                message: \"No user with associated ID. Check the entered number.\",\r\n                status: res.status,\r\n            });\r\n            res.send(\"invalid user\");\r\n\r\n        }\r\n    }\r\n\r\n    public async removeShoe(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        if (!(await helpers.check_local(userId))) {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user with associated ID. Check the entered number.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n        const idString = \"id2\";\r\n        const docID = req.params[idString];\r\n        const uif = new UserModel();\r\n        await uif.remove_shoe(docID);\r\n        res.redirect(\"/user/\" + userId + \"/shoes/\");\r\n    }\r\n\r\n    \r\n    /**\r\n     * GET all Shoes. Take user id from the url parameter. Then get all shoes for that user.\r\n     */\r\n    public async getAll(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        userShoes = [];\r\n        netGain = 0;\r\n        sunkCost = 0;\r\n        totalRevenue = 0;\r\n        userJson = await helpers.getUserInfo(queryint);\r\n        if (userJson) {\r\n            userKeys = await helpers.getUserKeys(queryint);\r\n            await helpers.setUserShoes(userKeys);\r\n            await helpers.setNet(userShoes);\r\n            console.log(userShoes);\r\n            console.log(netGain);\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, title: \"Shoes\", username: userJson.username, data: userShoes,\r\n                    net: netGain, sunk: sunkCost, total:totalRevenue, keys: userKeys});\r\n        } else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user found with the given id.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * GET one shoe by id\r\n     */\r\n\r\n    public async getOne(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const shoeIdString = \"id2\";\r\n        const shoeId = req.params[shoeIdString];\r\n        if (await helpers.check_local(userId)) {\r\n            const shoe = helpers.findShoe(shoeId);\r\n            if (shoe) {\r\n                const diff = shoe.current_price - shoe.purchase_price;\r\n                this.render(req, res, \"oneShoe\", {id: userId, diff, purchase:shoe.purchase_price, shoe});\r\n            } else {\r\n                res.status(404)\r\n                    .send({\r\n                        message: \"No shoe found with the given id.\",\r\n                        status: res.status,\r\n                    });\r\n            }\r\n        } else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user found with the given id.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n\r\n    }\r\n    \r\n}\r\n"]}
=======
{"version":3,"file":"customerRouter.js","sourceRoot":"","sources":["../../../src/routes/customerRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response, Router} from \"express\";\r\nimport { UserModel } from \"../models/user_model\";\r\nimport { BaseRoute } from \"./router\";\r\nimport helpers = require(\"../helperFunctions\");\r\n\r\nlet userJson: any;\r\nlet userShoes: any[] = [];\r\nlet userKeys: any;\r\nlet netGain: number = 0;\r\nlet sunkCost: number = 0;\r\nlet totalRevenue: number = 0;\r\n\r\nexport class CustomerRouter extends BaseRoute {\r\n\r\n    public static create(router: Router) {\r\n        // sorting all the shoes the user owns from low to high\r\n        router.get(\"/user/:id/shoes/sort/price_low\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().sortPriceLow(req, res, next);\r\n        });\r\n        // sorting the shoes the user owns from high to low\r\n        router.get(\"/user/:id/shoes/sort/price_high\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().sortPriceHigh(req, res, next);\r\n        });\r\n        router.post(\"/user/:id/add_shoe/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().addShoe(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/remove_shoe/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().removeShoe(req, res, next);\r\n        });\r\n        // users home page showing all the shoes the user owns\r\n        router.get(\"/user/:id/shoes\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().getAll(req, res, next);\r\n        });\r\n\r\n        // showing a specific shoe that the user owns\r\n        router.get(\"/user/:id/shoes/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new CustomerRouter().getOne(req, res, next);\r\n        });\r\n    }\r\n\r\n    public async sortPriceLow(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        if (await helpers.check_local(queryint)) {\r\n            const sortedShoes: any = userShoes;\r\n            sortedShoes.sort((a: any, b: any) => a.current_price - b.current_price);\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, username: userJson.username, title: \"Shoes\", data: sortedShoes, net: netGain,\r\n                total: totalRevenue, sunk: sunkCost});\r\n        } else {\r\n            res.status(404);\r\n            res.send(\"invalid user\");\r\n        }\r\n\r\n    }\r\n\r\n    public async sortPriceHigh(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        if (await helpers.check_local(queryint)) {\r\n            const sortedShoes: any = userShoes;\r\n            sortedShoes.sort((a: any, b: any) => b.current_price - a.current_price);\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, username: userJson.username, title: \"Shoes\", data: sortedShoes, net: netGain,\r\n                total: totalRevenue, sunk: sunkCost});\r\n        } else {\r\n            res.status(404);\r\n            res.send(\"invalid user\");\r\n        }\r\n\r\n    }\r\n\r\n\r\n    public async addShoe(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const shoeIdString = \"id2\";\r\n        const shoeId = parseInt(req.params[shoeIdString], 10);\r\n        if (await helpers.check_local(userId)) {\r\n            const uif = new UserModel();\r\n            let price = req.body.purchase_price;\r\n            if (!price) {\r\n                price = 0;\r\n            }\r\n            await uif.add_shoe(userId, shoeId, price);\r\n            res.redirect(\"/user/\" + userId + \"/shoes/\");\r\n        } else {\r\n            res.status(404)\r\n            .send({\r\n                message: \"No user with associated ID. Check the entered number.\",\r\n                status: res.status,\r\n            });\r\n            res.send(\"invalid user\");\r\n\r\n        }\r\n    }\r\n\r\n    public async removeShoe(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        if (!(await helpers.check_local(userId))) {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user with associated ID. Check the entered number.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n        const idString = \"id2\";\r\n        const docID = req.params[idString];\r\n        const uif = new UserModel();\r\n        await uif.remove_shoe(docID);\r\n        res.redirect(\"/user/\" + userId + \"/shoes/\");\r\n    }\r\n\r\n    \r\n    /**\r\n     * GET all Shoes. Take user id from the url parameter. Then get all shoes for that user.\r\n     */\r\n    public async getAll(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const queryint = parseInt(req.params[idString], 10);\r\n        userShoes = [];\r\n        netGain = 0;\r\n        sunkCost = 0;\r\n        totalRevenue = 0;\r\n        userJson = await helpers.getUserInfo(queryint);\r\n        if (userJson) {\r\n            userKeys = await helpers.getUserKeys(queryint);\r\n           userShoes = await helpers.setUserShoes(userKeys);\r\n            [netGain,sunkCost,totalRevenue]= await helpers.setNet(userShoes);\r\n\r\n            this.render(req, res, \"allShoes\",\r\n                {id: queryint, title: \"Shoes\", username: userJson.username, data: userShoes,\r\n                    net: netGain, sunk: sunkCost, total:totalRevenue, keys: userKeys});\r\n        } else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user found with the given id.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n    }\r\n\r\n    public async getOne(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const shoeIdString = \"id2\";\r\n        const shoeId = req.params[shoeIdString];\r\n        if (await helpers.check_local(userId)) {\r\n            const shoe = helpers.findShoe(shoeId);\r\n            if (shoe) {\r\n                const diff = shoe.current_price - shoe.purchase_price;\r\n                this.render(req, res, \"oneShoe\", {id: userId, diff, purchase:shoe.purchase_price, shoe});\r\n            } else {\r\n                res.status(404)\r\n                    .send({\r\n                        message: \"No shoe found with the given id.\",\r\n                        status: res.status,\r\n                    });\r\n            }\r\n        } else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user found with the given id.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n\r\n    }\r\n\r\n    \r\n}\r\n"]}
>>>>>>> 813f86ccfae5fcaf8d082907b25c0bee47f262cc
