{"version":3,"file":"shoeRouter.js","sourceRoot":"","sources":["../../../src/routes/shoeRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response, Router} from \"express\";\nimport { ShoeModel } from \"../models/shoe_model\";\nimport { BaseRoute } from \"./router\";\nimport helpers = require(\"../helperFunctions\");\n\n\nlet userJson: any;\nlet userKeys: any;\nlet userShoes: any[] = [];\n\nexport class ShoeRouter extends BaseRoute {\n\n    public static create(router: Router) {\n        // showing a specific shoe that the user owns\n        router.get(\"/user/:id/shoes/:id2\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().getOne(req, res, next);\n        });\n        // show all shoes from db\n        router.get(\"/user/:id/allShoes\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().allShoes(req, res, next);\n        });\n\n        // show all shoes sorted from high to low\n        router.get(\"/user/:id/allShoes/sort/price_high\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().sortPriceHighDb(req, res, next);\n        });\n\n        // show all shoes sorted from low to high\n\n        router.get(\"/user/:id/allShoes/sort/price_low\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().sortPriceLowDb(req, res, next);\n        });\n\n        /*router.get(\"/user/:id/notifications\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().notificationCentre(req, res, next);\n        });*/\n\n        router.get(\"/user/:id/add_shoe/:id2\", (req: Request, res: Response, next: NextFunction) => {\n            new ShoeRouter().inputShoe(req, res, next);\n        });\n    }\n\n    // get all the shoes from the db and render to shoesList view\n    public async allShoes(req: Request, res: Response, next: NextFunction) {\n        const idString = \"id\";\n        const userId = parseInt(req.params[idString], 10);\n        if (await helpers.check_local(userId)) {\n            const shoeIf = new ShoeModel();\n            const allShoes = await shoeIf.getAllDB();\n            this.render(req, res, \"shoeList\", {id: userId, title: \"Shoes\", data: allShoes});\n        } else {\n            res.status(404)\n                .send({\n                    message: \"No user found with the given user id.\",\n                    status: res.status,\n                });\n        }\n    }\n\n/*\n sort low to high all the shoes in db and render in the shoelist view\n */\n\n    public async sortPriceLowDb(req: Request, res: Response, next: NextFunction) {\n        const idString = \"id\";\n        const queryint = parseInt(req.params[idString], 10);\n        if (await helpers.check_local(queryint)) {\n            // const allShoes = this.getAllDbShoes()\n            const shoeIf = new ShoeModel();\n            const allShoes = await shoeIf.getAllDB();\n            const sortedShoes: any = allShoes;\n            sortedShoes.sort((a: any, b: any) => a.current_price - b.current_price);\n            this.render(req, res, \"shoeList\", {\n                data: sortedShoes,\n                id: queryint,\n                title: \"Shoes\",\n                username: userJson.username,\n            });\n        } else {\n            res.status(404);\n            res.send(\"invalid user\");\n        }\n    }\n    public async sortPriceHighDb(req: Request, res: Response, next: NextFunction) {\n        const idString = \"id\";\n        const queryint = parseInt(req.params[idString], 10);\n        if (await helpers.check_local(queryint)) {\n            const shoeIf = new ShoeModel();\n            const allShoes = await shoeIf.getAllDB();\n            const sortedShoes: any = allShoes;\n            sortedShoes.sort((a: any, b: any) => b.current_price - a.current_price);\n            this.render(req, res, \"shoeList\", {\n                data: sortedShoes,\n                id: queryint,\n                title: \"Shoes\",\n                username: userJson.username,\n            });\n        } else {\n            res.status(404);\n            res.send(\"invalid user\");\n        }\n    }\n\n    public async inputShoe(req: Request, res: Response, next: NextFunction) {\n        const userIdString = \"id\";\n        const userId = parseInt(req.params[userIdString], 10);\n        const shoeIdString = \"id2\";\n        const shoeId = parseInt(req.params[shoeIdString], 10);\n        const shoe = await this.getShoe(shoeId);\n        if (shoe) {\n            this.render(req, res, \"addShoe\", {id: userId, shoe});\n        } else {\n            res.status(404)\n                .send({\n                    message: \"No shoe found with the given id.\",\n                    status: res.status,\n                });\n        }\n\n    }\n\n    /**\n     * GET one shoe by id\n     */\n\n    public async getOne(req: Request, res: Response, next: NextFunction) {\n        const userIdString = \"id\";\n        const userId = parseInt(req.params[userIdString], 10);\n        const shoeIdString = \"id2\";\n        const shoeId = req.params[shoeIdString];\n        if (await helpers.check_local(userId)) {\n            const shoe = this.findShoe(shoeId);\n            if (shoe) {\n                const diff = shoe.current_price - shoe.purchase_price;\n                this.render(req, res, \"oneShoe\", {id: userId, diff, purchase:shoe.purchase_price, shoe});\n            } else {\n                res.status(404)\n                    .send({\n                        message: \"No shoe found with the given id.\",\n                        status: res.status,\n                    });\n            }\n        } else {\n            res.status(404)\n                .send({\n                    message: \"No user found with the given id.\",\n                    status: res.status,\n                });\n        }\n\n    }\n\n    private findShoe(shoeID: any) {\n        console.log(shoeID);\n        for (const item in userShoes) {\n            if (userShoes.hasOwnProperty(item)) {\n                const shoe = userShoes[item];\n                if (shoe._id == shoeID) return shoe;\n            }\n        }\n    }\n\n    private has_shoe(userShoes: any, shoeID: number) {\n        for (const item in userShoes) {\n            if (userShoes.hasOwnProperty(item)) {\n                const shoeid: number = userShoes[item].shoe_id;\n                if (shoeid === shoeID) {\n                   return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    private getPurchasePrice(id: number) {\n        let purchase = 0;\n        for (const item in userShoes) {\n            if (userShoes.hasOwnProperty(item)) {\n                const shoeid: number = userKeys[item].shoe_id;\n                if (shoeid === id) {\n                    purchase = userKeys[item].purchase_price;\n                }\n            }\n        }\n        return purchase;\n    }\n\n    private async getUserShoes(userKeys: any) {\n        const shoeIf = new ShoeModel();\n        const uShoes = await shoeIf.getAllShoes(userKeys);\n        return uShoes;\n    }\n\n    private async getShoe(shoeId: number) {\n        const shoeIf = new ShoeModel();\n        const shoe = await shoeIf.getOneShoe(shoeId);\n        if (shoe) {\n            return shoe;\n        } else {\n            return;\n        }\n    }\n\n}\n"]}