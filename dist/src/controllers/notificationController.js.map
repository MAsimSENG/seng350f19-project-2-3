{"version":3,"file":"notificationController.js","sourceRoot":"","sources":["../../../src/controllers/notificationController.ts"],"names":[],"mappings":"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","sourcesContent":["import { NextFunction, Request, Response, Router} from \"express\";\r\nimport Helpers = require(\"../helperFunctions\");\r\nimport { NotificationModel } from \"../models/notificationModel\";\r\nimport { ProductModel } from \"../models/productModel\";\r\nimport { BaseRoute } from \"../routes/router\";\r\n\r\nlet userNotifications: any;\r\nlet Shoes: any;\r\nlet id: number;\r\n\r\nexport class NotificationController extends BaseRoute {\r\n\r\n    public static create(router: Router) {\r\n        router.get(\"/user/:id/notifications\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().notificationCentre(req, res, next);\r\n        });\r\n\r\n        router.get(\"/user/:id/add_notification/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().inputNotification(req, res, next);\r\n        });\r\n\r\n        router.get(\"/user/:id/edit_notification/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().editNotificationForm(req, res, next);\r\n        });\r\n\r\n        router.get(\"/user/:id/notifications/filter/fulfilled\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().filterFulfilled(req, res, next);\r\n        });\r\n\r\n        router.get(\"/user/:id/notifications/filter/unfulfilled\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().filterUnfulfilled(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/add_notification/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().addNotification(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/remove_notification/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().removeNotification(req, res, next);\r\n        });\r\n\r\n        router.post(\"/user/:id/edit_notification/:id2\", (req: Request, res: Response, next: NextFunction) => {\r\n            new NotificationController().editNotification(req, res, next);\r\n        });\r\n    }\r\n\r\n    // constructor() {\r\n        // not much here yet\r\n    // }\r\n\r\n    public async notificationCentre(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const userId = parseInt(req.params[idString], 10);\r\n        if (await this.buildNotifications(userId)) {\r\n            this.render(req, res, \"notificationCentre\",\r\n                {id: userId, title: \"Notifications\", notifications: userNotifications});\r\n        } else {\r\n            res.status(404)\r\n            .send({\r\n                message: \"No user with associated ID. Check the entered number.\",\r\n                status: res.status,\r\n            });        }\r\n    }\r\n\r\n    public async filterFulfilled(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const userId = parseInt(req.params[idString], 10);\r\n        let fulfilledNots: any = [];\r\n        if(await this.check_local(userId)) {\r\n            for(const item in userNotifications) {\r\n                if(userNotifications.hasOwnProperty(item)) {\r\n                    if(userNotifications[item].fulfilled) {\r\n                        fulfilledNots.push(userNotifications[item]);\r\n                    }\r\n                }\r\n            }\r\n            this.render(req, res, \"notificationCentre\",\r\n                {id: userId, title: \"Notifications\", notifications: fulfilledNots});\r\n        }\r\n        else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user with associated ID. Check the entered number.\",\r\n                    status: res.status,\r\n                });        }\r\n    }\r\n\r\n    public async filterUnfulfilled(req: Request, res: Response, next: NextFunction) {\r\n        const idString = \"id\";\r\n        const userId = parseInt(req.params[idString], 10);\r\n        let unfulfilledNots: any = [];\r\n        if(await this.check_local(userId)) {\r\n            for(const item in userNotifications) {\r\n                if(userNotifications.hasOwnProperty(item)) {\r\n                    if(!userNotifications[item].fulfilled) {\r\n                        unfulfilledNots.push(userNotifications[item]);\r\n                    }\r\n                }\r\n            }\r\n            this.render(req, res, \"notificationCentre\",\r\n                {id: userId, title: \"Notifications\", notifications: unfulfilledNots});\r\n        }\r\n        else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No user with associated ID. Check the entered number.\",\r\n                    status: res.status,\r\n                });        }\r\n    }\r\n\r\n    public async addNotification(req: Request, res: Response, next: NextFunction) {\r\n        const uString = \"id\";\r\n        const sString = \"id2\";\r\n        const userID = parseInt(req.params[uString], 10);\r\n        const shoeID = parseInt(req.params[sString], 10);\r\n        const nIF = new NotificationModel();\r\n        let threshold = req.body.threshold;\r\n        if (!threshold) {\r\n            threshold = 0;\r\n        }\r\n        await nIF.addNotification(userID, shoeID, threshold, req.body.type);\r\n        res.redirect(\"/user/\" + userID + \"/allShoes\");\r\n    }\r\n\r\n    public async removeNotification(req: Request, res: Response, next: NextFunction) {\r\n        const uString = \"id\";\r\n        const idString = \"id2\";\r\n        const userID = parseInt(req.params[uString], 10);\r\n        const notifID = req.params[idString];\r\n        const nIF = new NotificationModel();\r\n        await nIF.remove_notif(notifID);\r\n        res.redirect(\"/user/\" + userID + \"/notifications\");\r\n    }\r\n\r\n    public async editNotification(req: Request, res: Response, next: NextFunction) {\r\n        const uString = \"id\";\r\n        const idString = \"id2\";\r\n        const userID = parseInt(req.params[uString], 10);\r\n        const notifID = req.params[idString];\r\n        const nIF = new NotificationModel();\r\n        if (!req.body.threshold) {\r\n            req.body.threshold = 0;\r\n        }\r\n        await nIF.edit_notif(notifID, req.body.threshold, req.body.type);\r\n        res.redirect(\"/user/\" + userID + \"/notifications\");\r\n    }\r\n\r\n    public async inputNotification(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const shoeIdString = \"id2\";\r\n        const shoeId = parseInt(req.params[shoeIdString], 10);\r\n        const shoeIF = new ProductModel();\r\n        const shoe = await shoeIF.getOneShoe(shoeId);\r\n        if (shoe && await Helpers.isUser(userId)) {\r\n            this.render(req, res, \"addNotification\", { id: userId, shoe });\r\n            /* res.status(200)\r\n                .send({\r\n                    message: 'Success',\r\n                    status: res.status,\r\n                    shoe\r\n                }); */\r\n        } else {\r\n            res.status(404)\r\n                .send({\r\n                    message: \"No shoe found with the given id.\",\r\n                    status: res.status,\r\n                });\r\n        }\r\n\r\n    }\r\n\r\n    public async editNotificationForm(req: Request, res: Response, next: NextFunction) {\r\n        const userIdString = \"id\";\r\n        const userId = parseInt(req.params[userIdString], 10);\r\n        const notIdString = \"id2\";\r\n        const notId = req.params[notIdString];\r\n        const notification = await this.getNotif(notId);\r\n        this.render(req, res, \"editNotification\", { id: userId, title: \"Notification\", notification });\r\n    }\r\n\r\n    private async buildNotifications(userID: number) {\r\n        if (await Helpers.isUser(userID)) {\r\n            id = userID;\r\n            await this.setLocals(userID);\r\n            for (const item in userNotifications) {\r\n                if (userNotifications.hasOwnProperty(item)) {\r\n                    const notification = userNotifications[item];\r\n                    const shoe = this.getShoe(notification.shoe_id);\r\n                    notification[\"shoename\"] = shoe.brand + \" \" + shoe.model + \" \" + shoe.colorway;\r\n                    notification[\"current_price\"] = shoe.current_price;\r\n                    notification[\"size\"] = shoe.size;\r\n                    await this.checkFulfilled(notification, shoe.current_price);\r\n                }\r\n            }\r\n            userNotifications.sort((a: any, b: any) => {\r\n                return a.shoename.toLowerCase().localeCompare(b.shoename.toLowerCase());\r\n            });\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private async checkFulfilled(notification: any, currentPrice: any) {\r\n        if (!notification.fulfilled) {\r\n            if ((notification.type === \"Below\") && (notification.threshold > currentPrice)) {\r\n                await this.fulfill(notification._id);\r\n                notification.fulfilled = true;\r\n            }\r\n            if ((notification.type == \"Above\") && (notification.threshold < currentPrice)) {\r\n                await this.fulfill(notification._id);\r\n                notification.fulfilled = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private async fulfill(notification: any) {\r\n        const nIF = new NotificationModel();\r\n        await nIF.fulfill(notification._id);\r\n    }\r\n\r\n    private async check_local(userID: number) {\r\n        if (!userNotifications) {\r\n            return await this.buildNotifications(userID);\r\n        } else if (id !== userID) {\r\n            return await this.buildNotifications(userID);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private async setLocals(userID: number) {\r\n        await this.setUserNotifications(userID);\r\n        Shoes = await Helpers.getAllDbShoes();\r\n    }\r\n\r\n    private async setUserNotifications(userID: number) {\r\n        const notifIf = new NotificationModel();\r\n        userNotifications = await notifIf.getUserNotifications(userID);\r\n    }\r\n\r\n    private getShoe(shoeID: number) {\r\n        for (const item in Shoes) {\r\n            if (Shoes.hasOwnProperty(item)) {\r\n                const shoe = Shoes[item];\r\n                if (shoe.shoe_id === shoeID) {\r\n                    return shoe;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private async getNotif(id: any) {\r\n        const nIF = new NotificationModel();\r\n        const notif = await nIF.get_notif(id);\r\n        return notif[0];\r\n    }\r\n\r\n}\r\n"]}